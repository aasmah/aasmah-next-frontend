{"ast":null,"code":"/* /lib/auth.js */\nimport jwtDecode from \"jwt-decode\";\nimport Cookies from \"js-cookie\";\nimport Strapi from \"strapi-sdk-javascript/build/main\";\nimport Router from \"next/router\";\nimport { env } from \"../utils/constants\";\nconst apiUrl = env.API_URL;\nconst strapi = new Strapi(apiUrl);\nexport const strapiRegister = (username, email, password) => {\n  if (!false) {\n    return undefined;\n  }\n\n  strapi.register(username, email, password).then(res => {\n    setToken(res);\n  });\n  return Promise.resolve();\n}; //use strapi to get a JWT and token object, save\n//to approriate cookei for future requests\n\nexport const strapiLogin = (email, password) => {\n  if (!false) {\n    return;\n  } // Get a token\n\n\n  strapi.login(email, password).then(res => {\n    setToken(res);\n  });\n  return Promise.resolve();\n};\nexport const setToken = token => {\n  if (!false) {\n    return;\n  }\n\n  Cookies.set(\"username\", token.user.username);\n  Cookies.set(\"jwt\", token.jwt);\n\n  if (Cookies.get(\"username\")) {\n    Router.push(\"/\");\n  }\n};\nexport const unsetToken = () => {\n  if (!false) {\n    return;\n  }\n\n  Cookies.remove(\"jwt\");\n  Cookies.remove(\"username\");\n  Cookies.remove(\"cart\"); // to support logging out from all windows\n\n  window.localStorage.setItem(\"logout\", Date.now());\n  Router.push(\"/\");\n};\nexport const getUserFromServerCookie = req => {\n  if (!req.headers.cookie || \"\") {\n    return undefined;\n  }\n\n  let username = req.headers.cookie.split(\";\").find(user => user.trim().startsWith(\"username=\"));\n\n  if (username) {\n    username = username.split(\"=\")[1];\n  }\n\n  const jwtCookie = req.headers.cookie.split(\";\").find(c => c.trim().startsWith(\"jwt=\"));\n\n  if (!jwtCookie) {\n    return undefined;\n  }\n\n  const jwt = jwtCookie.split(\"=\")[1];\n  return jwtDecode(jwt), username;\n};\nexport const getUserFromLocalCookie = () => {\n  return Cookies.get(\"username\");\n}; //these will be used if you expand to a provider such as Auth0\n\nconst getQueryParams = () => {\n  const params = {};\n  window.location.href.replace(/([^(?|#)=&]+)(=([^&]*))?/g, ($0, $1, $2, $3) => {\n    params[$1] = $3;\n  });\n  return params;\n};\n\nexport const extractInfoFromHash = () => {\n  if (!false) {\n    return undefined;\n  }\n\n  const {\n    id_token,\n    state\n  } = getQueryParams();\n  return {\n    token: id_token,\n    secret: state\n  };\n};","map":{"version":3,"sources":["C:/Users/aas_8/Desktop/restaurant stripe/lib/auth.js"],"names":["jwtDecode","Cookies","Strapi","Router","env","apiUrl","API_URL","strapi","strapiRegister","username","email","password","undefined","register","then","res","setToken","Promise","resolve","strapiLogin","login","token","set","user","jwt","get","push","unsetToken","remove","window","localStorage","setItem","Date","now","getUserFromServerCookie","req","headers","cookie","split","find","trim","startsWith","jwtCookie","c","getUserFromLocalCookie","getQueryParams","params","location","href","replace","$0","$1","$2","$3","extractInfoFromHash","id_token","state","secret"],"mappings":"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","sourcesContent":["/* /lib/auth.js */\r\n\r\nimport jwtDecode from \"jwt-decode\";\r\nimport Cookies from \"js-cookie\";\r\nimport Strapi from \"strapi-sdk-javascript/build/main\";\r\n\r\nimport Router from \"next/router\";\r\n\r\nimport { env } from \"../utils/constants\";\r\n\r\nconst apiUrl = env.API_URL;\r\nconst strapi = new Strapi(apiUrl);\r\n\r\nexport const strapiRegister = (username, email, password) => {\r\n  if (!process.browser) {\r\n    return undefined;\r\n  }\r\n  strapi.register(username, email, password).then(res => {\r\n    setToken(res);\r\n  });\r\n  return Promise.resolve();\r\n};\r\n//use strapi to get a JWT and token object, save\r\n//to approriate cookei for future requests\r\nexport const strapiLogin = (email, password) => {\r\n  if (!process.browser) {\r\n    return;\r\n  }\r\n  // Get a token\r\n  strapi.login(email, password).then(res => {\r\n    setToken(res);\r\n  });\r\n  return Promise.resolve();\r\n};\r\n\r\nexport const setToken = token => {\r\n  if (!process.browser) {\r\n    return;\r\n  }\r\n  Cookies.set(\"username\", token.user.username);\r\n  Cookies.set(\"jwt\", token.jwt);\r\n\r\n  if (Cookies.get(\"username\")) {\r\n    Router.push(\"/\");\r\n  }\r\n};\r\n\r\nexport const unsetToken = () => {\r\n  if (!process.browser) {\r\n    return;\r\n  }\r\n  Cookies.remove(\"jwt\");\r\n  Cookies.remove(\"username\");\r\n  Cookies.remove(\"cart\");\r\n\r\n  // to support logging out from all windows\r\n  window.localStorage.setItem(\"logout\", Date.now());\r\n  Router.push(\"/\");\r\n};\r\n\r\nexport const getUserFromServerCookie = req => {\r\n  if (!req.headers.cookie || \"\") {\r\n    return undefined;\r\n  }\r\n\r\n  let username = req.headers.cookie\r\n    .split(\";\")\r\n    .find(user => user.trim().startsWith(\"username=\"));\r\n  if (username) {\r\n    username = username.split(\"=\")[1];\r\n  }\r\n\r\n  const jwtCookie = req.headers.cookie\r\n    .split(\";\")\r\n    .find(c => c.trim().startsWith(\"jwt=\"));\r\n  if (!jwtCookie) {\r\n    return undefined;\r\n  }\r\n  const jwt = jwtCookie.split(\"=\")[1];\r\n  return jwtDecode(jwt), username;\r\n};\r\n\r\nexport const getUserFromLocalCookie = () => {\r\n  return Cookies.get(\"username\");\r\n};\r\n\r\n//these will be used if you expand to a provider such as Auth0\r\nconst getQueryParams = () => {\r\n  const params = {};\r\n  window.location.href.replace(\r\n    /([^(?|#)=&]+)(=([^&]*))?/g,\r\n    ($0, $1, $2, $3) => {\r\n      params[$1] = $3;\r\n    }\r\n  );\r\n  return params;\r\n};\r\nexport const extractInfoFromHash = () => {\r\n  if (!process.browser) {\r\n    return undefined;\r\n  }\r\n  const { id_token, state } = getQueryParams();\r\n  return { token: id_token, secret: state };\r\n};"]},"metadata":{},"sourceType":"module"}
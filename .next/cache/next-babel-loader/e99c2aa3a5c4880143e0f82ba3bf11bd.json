{"ast":null,"code":"/* /lib/auth.js */\nimport jwtDecode from \"jwt-decode\";\nimport Cookies from \"js-cookie\";\nimport Strapi from \"strapi-sdk-javascript/build/main\";\nimport Router from \"next/router\";\nimport { env } from \"../utils/constants\";\nvar apiUrl = env.API_URL;\nvar strapi = new Strapi(apiUrl);\nexport var strapiRegister = function strapiRegister(username, email, password) {\n  if (!true) {\n    return undefined;\n  }\n\n  strapi.register(username, email, password).then(function (res) {\n    setToken(res);\n  });\n  return Promise.resolve();\n}; //use strapi to get a JWT and token object, save\n//to approriate cookie for future requests\n\nexport var strapiLogin = function strapiLogin(email, password) {\n  if (!true) {\n    return;\n  } // Get a token\n\n\n  strapi.login(email, password).then(function (res) {\n    setToken(res);\n  });\n  return Promise.resolve();\n};\nexport var setToken = function setToken(token) {\n  if (!true) {\n    return;\n  }\n\n  Cookies.set(\"username\", token.user.username);\n  Cookies.set(\"jwt\", token.jwt);\n\n  if (Cookies.get(\"username\")) {\n    Router.push(\"/\");\n  }\n};\nexport var unsetToken = function unsetToken() {\n  if (!true) {\n    return;\n  }\n\n  Cookies.remove(\"jwt\");\n  Cookies.remove(\"username\");\n  Cookies.remove(\"cart\"); // to support logging out from all windows\n\n  window.localStorage.setItem(\"logout\", Date.now());\n  Router.push(\"/\");\n};\nexport var getUserFromServerCookie = function getUserFromServerCookie(req) {\n  if (!req.headers.cookie || \"\") {\n    return undefined;\n  }\n\n  var username = req.headers.cookie.split(\";\").find(function (user) {\n    return user.trim().startsWith(\"username=\");\n  });\n\n  if (username) {\n    username = username.split(\"=\")[1];\n  }\n\n  var jwtCookie = req.headers.cookie.split(\";\").find(function (c) {\n    return c.trim().startsWith(\"jwt=\");\n  });\n\n  if (!jwtCookie) {\n    return undefined;\n  }\n\n  var jwt = jwtCookie.split(\"=\")[1];\n  return jwtDecode(jwt), username;\n};\nexport var getUserFromLocalCookie = function getUserFromLocalCookie() {\n  return Cookies.get(\"username\");\n}; //these will be used if you expand to a provider such as Auth0\n\nvar getQueryParams = function getQueryParams() {\n  var params = {};\n  window.location.href.replace(/([^(?|#)=&]+)(=([^&]*))?/g, function ($0, $1, $2, $3) {\n    params[$1] = $3;\n  });\n  return params;\n};\n\nexport var extractInfoFromHash = function extractInfoFromHash() {\n  if (!true) {\n    return undefined;\n  }\n\n  var _getQueryParams = getQueryParams(),\n      id_token = _getQueryParams.id_token,\n      state = _getQueryParams.state;\n\n  return {\n    token: id_token,\n    secret: state\n  };\n};","map":{"version":3,"sources":["C:/Users/aas_8/Desktop/restaurant stripe/lib/auth.js"],"names":["jwtDecode","Cookies","Strapi","Router","env","apiUrl","API_URL","strapi","strapiRegister","username","email","password","undefined","register","then","res","setToken","Promise","resolve","strapiLogin","login","token","set","user","jwt","get","push","unsetToken","remove","window","localStorage","setItem","Date","now","getUserFromServerCookie","req","headers","cookie","split","find","trim","startsWith","jwtCookie","c","getUserFromLocalCookie","getQueryParams","params","location","href","replace","$0","$1","$2","$3","extractInfoFromHash","id_token","state","secret"],"mappings":"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","sourcesContent":["/* /lib/auth.js */\r\n\r\nimport jwtDecode from \"jwt-decode\";\r\nimport Cookies from \"js-cookie\";\r\nimport Strapi from \"strapi-sdk-javascript/build/main\";\r\n\r\nimport Router from \"next/router\";\r\n\r\nimport { env } from \"../utils/constants\";\r\n\r\nconst apiUrl = env.API_URL;\r\nconst strapi = new Strapi(apiUrl);\r\n\r\nexport const strapiRegister = (username, email, password) => {\r\n  if (!process.browser) {\r\n    return undefined;\r\n  }\r\n  strapi.register(username, email, password).then(res => {\r\n    setToken(res);\r\n  });\r\n  return Promise.resolve();\r\n};\r\n//use strapi to get a JWT and token object, save\r\n//to approriate cookie for future requests\r\nexport const strapiLogin = (email, password) => {\r\n  if (!process.browser) {\r\n    return;\r\n  }\r\n  // Get a token\r\n  strapi.login(email, password).then(res => {\r\n    setToken(res);\r\n  });\r\n  return Promise.resolve();\r\n};\r\n\r\nexport const setToken = token => {\r\n  if (!process.browser) {\r\n    return;\r\n  }\r\n  Cookies.set(\"username\", token.user.username);\r\n  Cookies.set(\"jwt\", token.jwt);\r\n\r\n  if (Cookies.get(\"username\")) {\r\n    Router.push(\"/\");\r\n  }\r\n};\r\n\r\nexport const unsetToken = () => {\r\n  if (!process.browser) {\r\n    return;\r\n  }\r\n  Cookies.remove(\"jwt\");\r\n  Cookies.remove(\"username\");\r\n  Cookies.remove(\"cart\");\r\n\r\n  // to support logging out from all windows\r\n  window.localStorage.setItem(\"logout\", Date.now());\r\n  Router.push(\"/\");\r\n};\r\n\r\nexport const getUserFromServerCookie = req => {\r\n  if (!req.headers.cookie || \"\") {\r\n    return undefined;\r\n  }\r\n\r\n  let username = req.headers.cookie\r\n    .split(\";\")\r\n    .find(user => user.trim().startsWith(\"username=\"));\r\n  if (username) {\r\n    username = username.split(\"=\")[1];\r\n  }\r\n\r\n  const jwtCookie = req.headers.cookie\r\n    .split(\";\")\r\n    .find(c => c.trim().startsWith(\"jwt=\"));\r\n  if (!jwtCookie) {\r\n    return undefined;\r\n  }\r\n  const jwt = jwtCookie.split(\"=\")[1];\r\n  return jwtDecode(jwt), username;\r\n};\r\n\r\nexport const getUserFromLocalCookie = () => {\r\n  return Cookies.get(\"username\");\r\n};\r\n\r\n//these will be used if you expand to a provider such as Auth0\r\nconst getQueryParams = () => {\r\n  const params = {};\r\n  window.location.href.replace(\r\n    /([^(?|#)=&]+)(=([^&]*))?/g,\r\n    ($0, $1, $2, $3) => {\r\n      params[$1] = $3;\r\n    }\r\n  );\r\n  return params;\r\n};\r\nexport const extractInfoFromHash = () => {\r\n  if (!process.browser) {\r\n    return undefined;\r\n  }\r\n  const { id_token, state } = getQueryParams();\r\n  return { token: id_token, secret: state };\r\n};"]},"metadata":{},"sourceType":"module"}